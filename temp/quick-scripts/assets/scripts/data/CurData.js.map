{"version":3,"sources":["CurData.js"],"names":["cc","Class","ctor","initCommonConfig","commonConfig","MatType","matNameToType","MatName","matTypeToName","initConfigData","passIdx","configData","passData","getConfigData","gridInfo","mapH","mapInfo","row","gridH","mapW","col","gridW","mapSize","w","h","gameData","initGameData","gridData","rebuildGameData","mapData","rowKey","rowData","colKey","colData","material","initEachGridData","utils","setProperty","getGridPosByRowCol","getPropertyOrInit","x","y","halfGridW","parseInt","halfGridH","gridX","gridY","staggerY","getGridInfoByMousePos","undefined","pos"],"mappings":"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","file":"CurData.js","sourceRoot":"../../../../../assets/scripts/data","sourcesContent":["cc.Class({\n    ctor(){\n        /*\n        mapSize : {w:xx,h:xx},\n        */\n\n        /*\n        \"gameData\":{\n            gridData : {[row]:{\n                                [col]:{\n                                        pos:{x:0,y:0},//run time data\n                                },\n                       },}\n        }\n        */\n\n        /*\n        \"mapData\":{\n            [row]:{\n                    [col]:{\n                            material:{0:num,1:num,...},\n                    },\n            }\n        }\n        */\n    },\n    //////////////////////////////////////////////////////////////\n    //游戏配置\n    initCommonConfig(commonConfig){\n        this.commonConfig = commonConfig;\n        this.MatType = this.commonConfig.matNameToType;\n        this.MatName = this.commonConfig.matTypeToName;\n    },\n    initConfigData(passIdx){\n        this.passIdx = passIdx;\n        this.configData = cc.passData.getConfigData(passIdx);\n\n        var gridInfo = this.commonConfig.gridInfo;\n        var mapH = this.configData.mapInfo.row*gridInfo.gridH;\n        var mapW = this.configData.mapInfo.col*gridInfo.gridW;\n        this.mapSize = {w:mapW,h:mapH};\n        this.gameData = {}\n        this.initGameData();\n    },\n    initGameData(){\n        this.gameData.gridData = {};\n        this.rebuildGameData();\n    },\n    rebuildGameData(){\n        var mapData = this.configData.mapData;\n        for(var rowKey in mapData){\n            var rowData = mapData[rowKey]\n            if(!rowData){\n                continue;\n            }\n            for(var colKey in rowData){\n                var colData = rowData[colKey];\n                if(!colData||!colData.material){\n                    continue;\n                }\n                this.initEachGridData(colData.material,rowKey,colKey);\n            }\n        }\n    },\n    initEachGridData(material,rowKey,colKey){\n        cc.utils.setProperty(this.gameData.gridData,\n            rowKey,colKey,\n            this.getGridPosByRowCol(rowKey,colKey));\n    },\n    getGridPosByRowCol(row,col){\n        var gridData = cc.utils.getPropertyOrInit(this.gameData.gridData,row,col);\n        if(!gridData.x||!gridData.y){\n            var gridInfo = this.commonConfig.gridInfo;\n            var halfGridW = parseInt(gridInfo.gridW/2);\n            var halfGridH = parseInt(gridInfo.gridH/2);\n\n            var mapSize = this.mapSize;\n\n            var gridX = col*gridInfo.gridW+halfGridW;\n\n            var gridY = 0;\n            if(col%2==0){\n                gridY = row*gridInfo.gridH+halfGridH;\n            }else{\n                gridY = row*gridInfo.gridH+halfGridH+gridInfo.staggerY;\n            }\n            gridData.x=gridX-mapSize.w*0.5;\n            gridData.y=gridY-mapSize.h*0.5;\n        }\n        return gridData;\n    },\n    getGridInfoByMousePos(x,y){\n        //return {row=?,col=?,x=?,y=?}\n\n        // gridInfo\n        // \"staggerY\":65,//奇数Y错开\n        // \"staggerX\":0, //奇数X错开\n        // \"gridW\":110,\n        // \"gridH\":130\n\n        var gridInfo = this.commonConfig.gridInfo;\n        if(x<0||y<0){\n            return undefined;\n        }\n\n        var col = parseInt(x/gridInfo.gridW);\n\n        var row = 0;\n        if(col%2==0){\n            row = parseInt(y/gridInfo.gridH);\n        }else{\n            if(y<gridInfo.staggerY){\n                return undefined;\n            }\n            row = parseInt((y - gridInfo.staggerY)/gridInfo.gridH);\n        }\n        var pos = this.getGridPosByRowCol(row,col);\n        return {col:col,row:row,x:pos.x,y:pos.y};\n    },\n});"]}