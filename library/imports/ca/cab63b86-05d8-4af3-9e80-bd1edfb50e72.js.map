{"version":3,"sources":["../../../../../assets/scripts/data/assets/scripts/data/PassData.js"],"names":["cc","Class","ctor","init","GameDataClass","configList","commonConfig","resMgr","getRes","resName","passCommon","passAuto","template","passTpl","matTypeArr","matNameToType","matTypeToName","matIcon","idx","length","matName","matAlias","split","matShowOrder","matShowOrderMap","curPassData","initCommonConfig","initConfigList","onFinished","gameConfig","isEditorMode","sys","isNative","platform","WIN32","MACOS","path","loadedCallback","err","res","log","savePassAuto","savePassAll","mapInfo","scale","loadEditorRes","bind","error","key","aRes","loadPass","passIdx","callback","JSON","stringify","initCurPassData","url","loadRes","utils","clone","passCount","writeEditorRes","savePass","initConfigData","curEditorData","curMatierl","userData","getPassCount","getConfigData","getConfigList","getCurPassData","getCurPassIdx","getCurEditorData","getCommonConfig"],"mappings":";;;;;;AAAAA,GAAGC,KAAH,CAAS;AACLC,QADK,kBACC,CAEL,CAHI;AAILC,QAJK,gBAIAC,aAJA,EAIc;;AAEf,aAAKC,UAAL,GAAkB,EAAlB;;AAEA,aAAKC,YAAL,GAAoBN,GAAGO,MAAH,CAAUC,MAAV,CAAiBR,GAAGS,OAAH,CAAWC,UAA5B,CAApB;;AAEA,aAAKC,QAAL,GAAgBX,GAAGO,MAAH,CAAUC,MAAV,CAAiBR,GAAGS,OAAH,CAAWE,QAA5B,CAAhB;;AAEA,aAAKC,QAAL,GAAgBZ,GAAGO,MAAH,CAAUC,MAAV,CAAiBR,GAAGS,OAAH,CAAWI,OAA5B,CAAhB;;AAEA,YAAIC,aAAa,KAAKR,YAAL,CAAkBQ,UAAnC;AACA,YAAIC,gBAAgB,KAAKT,YAAL,CAAkBS,aAAtC;AACA,YAAIC,gBAAgB,KAAKV,YAAL,CAAkBU,aAAtC;AACA,YAAIC,UAAU,KAAKX,YAAL,CAAkBW,OAAhC;AACA,aAAI,IAAIC,MAAI,CAAZ,EAAcA,MAAIJ,WAAWK,MAA7B,EAAoCD,KAApC,EAA0C;AACtC,gBAAIE,UAAUN,WAAWI,GAAX,CAAd;AACAH,0BAAcK,OAAd,IAAyBF,GAAzB;AACAF,0BAAcE,GAAd,IAAqB,EAACE,SAAQA,OAAT,EAAiBC,UAASD,QAAQE,KAAR,CAAc,GAAd,EAAmB,CAAnB,CAA1B,EAArB;AACAL,oBAAQC,GAAR,IAAe,QAAME,OAArB;AACH;AACD,YAAIG,eAAe,KAAKjB,YAAL,CAAkBiB,YAArC;AACA,YAAIC,kBAAkB,EAAtB;AACA,aAAI,IAAIN,MAAI,CAAZ,EAAcA,MAAIK,aAAaJ,MAA/B,EAAsCD,KAAtC,EAA4C;AACxCM,4BAAgBD,aAAaL,GAAb,CAAhB,IAAqCA,GAArC;AACH;AACD,aAAKZ,YAAL,CAAkBkB,eAAlB,GAAoCA,eAApC;;AAEA,aAAKC,WAAL,GAAmB,IAAIrB,aAAJ,EAAnB;AACA,aAAKqB,WAAL,CAAiBC,gBAAjB,CAAkC,KAAKpB,YAAvC;AACH,KAjCI;AAkCLqB,kBAlCK,0BAkCUC,UAlCV,EAkCqB;AACtB,YAAG5B,GAAG6B,UAAH,CAAcC,YAAd,IACA9B,GAAG+B,GAAH,CAAOC,QADP,KAEAhC,GAAG+B,GAAH,CAAOE,QAAP,IAAmBjC,GAAG+B,GAAH,CAAOG,KAA1B,IAAiClC,GAAG+B,GAAH,CAAOE,QAAP,IAAmBjC,GAAG+B,GAAH,CAAOI,KAF3D,CAAH,EAEqE;AACjE,gBAAIjB,MAAI,CAAR;AACA,gBAAIkB,OAAK,mBAAT;AACA,gBAAIC,iBAAiB,UAASC,GAAT,EAAaC,GAAb,EAAiB;AAClC,oBAAGD,GAAH,EAAO;AACHtC,uBAAGwC,GAAH,CAAO,wCAAP,EAAgDtB,GAAhD;AACA,yBAAKuB,YAAL;AACA,yBAAKC,WAAL;AACAd;AACA;AACH;;AAED;AACAW,oBAAII,OAAJ,CAAYC,KAAZ,GAAoBL,IAAII,OAAJ,CAAYC,KAAZ,IAAqB,GAAzC;;AAEA,qBAAKvC,UAAL,CAAgBa,GAAhB,IAAqBqB,GAArB;AACArB;AACAlB,mBAAGO,MAAH,CAAUsC,aAAV,CAAwBT,OAAKlB,GAA7B,EAAiCmB,cAAjC;AACH,aAfoB,CAenBS,IAfmB,CAed,IAfc,CAArB;AAgBA9C,eAAGO,MAAH,CAAUsC,aAAV,CAAwBT,OAAKlB,GAA7B,EAAiCmB,cAAjC;AACH,SAtBD,MAsBK;AACD,gBAAIA,iBAAiB,UAASC,GAAT,EAAaC,GAAb,EAAiB;AAClC,oBAAGD,GAAH,EAAO;AACHtC,uBAAG+C,KAAH,CAAS,sBAAT;AACA;AACH;;AAED;AACA,qBAAI,IAAIC,GAAR,IAAeT,GAAf,EAAmB;AACf,wBAAIU,OAAOV,IAAIS,GAAJ,CAAX;AACA,wBAAGC,IAAH,EAAQ;AACJA,6BAAKN,OAAL,CAAaC,KAAb,GAAqBK,KAAKN,OAAL,CAAaC,KAAb,IAAsB,GAA3C;AACH;AACJ;;AAED,qBAAKvC,UAAL,GAAkBkC,GAAlB;AACAvC,mBAAGwC,GAAH,CAAO,wCAAP,EAAgD,KAAKnC,UAAL,CAAgBc,MAAhE;AACAS;AACH,aAjBoB,CAiBnBkB,IAjBmB,CAiBd,IAjBc,CAArB;AAkBA9C,eAAGO,MAAH,CAAUsC,aAAV,CAAwB,sBAAxB,EAA+CR,cAA/C;AACH;AACJ,KA9EI;AA+ELa,YA/EK,oBA+EIC,OA/EJ,EA+EYC,QA/EZ,EA+EqB;AACtBpD,WAAGwC,GAAH,CAAO,kBAAP,EAA0BW,OAA1B;AACA,YAAG,KAAK9C,UAAL,CAAgB8C,OAAhB,CAAH,EAA4B;AACxBnD,eAAGwC,GAAH,CAAO,6BAAP,EACIa,KAAKC,SAAL,CAAe,KAAKjD,UAAL,CAAgB8C,OAAhB,CAAf,CADJ;AAEA,iBAAKI,eAAL,CAAqBJ,OAArB;AACAC,qBAAS,IAAT;AACA;AACH;AACD,YAAII,MAAM,sBAAoBL,OAA9B;AACAnD,WAAGO,MAAH,CAAUkD,OAAV,CAAkBD,GAAlB,EAAsB,UAASlB,GAAT,EAAaC,GAAb,EAAiB;AACnC,gBAAGD,GAAH,EAAO;AACH,oBAAGtC,GAAG6B,UAAH,CAAcC,YAAjB,EAA8B;AAC1B9B,uBAAGwC,GAAH,CAAO,mBAAP,EAA2BgB,GAA3B,EAA+B,+BAA/B;AACA,yBAAKnD,UAAL,CAAgB8C,OAAhB,IAAyBnD,GAAG0D,KAAH,CAASC,KAAT,CAAe,KAAK/C,QAApB,CAAzB;AACA,yBAAK2C,eAAL,CAAqBJ,OAArB;AACAC,6BAAS,IAAT;AACH,iBALD,MAKK;AACDpD,uBAAGwC,GAAH,CAAO,mBAAP,EAA2BgB,GAA3B,EAA+B,SAA/B;AACAJ,6BAAS,KAAT;AACH;AACD;AACH;AACDpD,eAAGwC,GAAH,CAAO,mBAAP,EAA2BgB,GAA3B,EAA+B,UAA/B;;AAEA;AACAjB,gBAAII,OAAJ,CAAYC,KAAZ,GAAoBL,IAAII,OAAJ,CAAYC,KAAZ,IAAqB,GAAzC;;AAEA,iBAAKvC,UAAL,CAAgB8C,OAAhB,IAAyBZ,GAAzB;AACA,iBAAKgB,eAAL,CAAqBJ,OAArB;AACAC,qBAAS,IAAT;AACH,SArBqB,CAqBpBN,IArBoB,CAqBf,IArBe,CAAtB;AAsBH,KA/GI;AAgHLL,gBAhHK,0BAgHS;AACV,aAAK9B,QAAL,CAAciD,SAAd,GAA0B,KAAKvD,UAAL,CAAgBc,MAA1C;AACAnB,WAAGO,MAAH,CAAUsD,cAAV,CAAyB,4BAAzB,EAAsDR,KAAKC,SAAL,CAAe,KAAK3C,QAApB,CAAtD;AACH,KAnHI;AAoHL+B,eApHK,yBAoHQ;AACT1C,WAAGO,MAAH,CAAUsD,cAAV,CAAyB,2BAAzB,EAAqDR,KAAKC,SAAL,CAAe,KAAKjD,UAApB,CAArD;AACH,KAtHI;AAuHLyD,YAvHK,oBAuHIX,OAvHJ,EAuHY;AACbnD,WAAGO,MAAH,CAAUsD,cAAV,CAAyB,sBAAoBV,OAApB,GAA4B,OAArD,EAA6DE,KAAKC,SAAL,CAAe,KAAKjD,UAAL,CAAgB8C,OAAhB,CAAf,CAA7D;AACA,aAAKV,YAAL;AACH,KA1HI;AA2HLc,mBA3HK,2BA2HWJ,OA3HX,EA2HmB;AACpB,aAAK1B,WAAL,CAAiBsC,cAAjB,CAAgCZ,OAAhC;AACA,aAAKa,aAAL,GAAqB,EAACC,YAAW,CAAZ,EAArB;AACAjE,WAAGkE,QAAH,CAAYJ,QAAZ,CAAqBX,OAArB;AACH,KA/HI;AAgILgB,gBAhIK,0BAgIS;AACV,eAAO,KAAKxD,QAAL,CAAciD,SAArB;AACH,KAlII;AAmILQ,iBAnIK,yBAmISjB,OAnIT,EAmIiB;AAClB,eAAO,KAAK9C,UAAL,CAAgB8C,OAAhB,CAAP;AACH,KArII;AAsILkB,iBAtIK,2BAsIU;AACX,eAAO,KAAKhE,UAAZ;AACH,KAxII;AAyILiE,kBAzIK,4BAyIW;AACZ,eAAO,KAAK7C,WAAZ;AACH,KA3II;AA4IL8C,iBA5IK,2BA4IU;AACX,eAAO,KAAK9C,WAAL,CAAiB0B,OAAxB;AACH,KA9II;AA+ILqB,oBA/IK,8BA+Ia;AACd,eAAO,KAAKR,aAAZ;AACH,KAjJI;AAkJLS,mBAlJK,6BAkJY;AACb,eAAO,KAAKnE,YAAZ;AACH;AApJI,CAAT","file":"PassData.js","sourceRoot":"../../../../../assets/scripts/data","sourcesContent":["cc.Class({\n    ctor(){\n        \n    },\n    init(GameDataClass){\n\n        this.configList = [];\n\n        this.commonConfig = cc.resMgr.getRes(cc.resName.passCommon);\n\n        this.passAuto = cc.resMgr.getRes(cc.resName.passAuto);\n\n        this.template = cc.resMgr.getRes(cc.resName.passTpl);\n\n        var matTypeArr = this.commonConfig.matTypeArr;\n        var matNameToType = this.commonConfig.matNameToType;\n        var matTypeToName = this.commonConfig.matTypeToName;\n        var matIcon = this.commonConfig.matIcon;\n        for(var idx=0;idx<matTypeArr.length;idx++){\n            var matName = matTypeArr[idx];\n            matNameToType[matName] = idx;\n            matTypeToName[idx] = {matName:matName,matAlias:matName.split(\"_\")[0]};\n            matIcon[idx] = \"ui-\"+matName;\n        }\n        var matShowOrder = this.commonConfig.matShowOrder;\n        var matShowOrderMap = {}\n        for(var idx=0;idx<matShowOrder.length;idx++){\n            matShowOrderMap[matShowOrder[idx]] = idx;\n        }\n        this.commonConfig.matShowOrderMap = matShowOrderMap;\n\n        this.curPassData = new GameDataClass();\n        this.curPassData.initCommonConfig(this.commonConfig);\n    },\n    initConfigList(onFinished){\n        if(cc.gameConfig.isEditorMode&&\n           cc.sys.isNative&&\n          (cc.sys.platform == cc.sys.WIN32||cc.sys.platform == cc.sys.MACOS)){\n            var idx=0;\n            var path=\"/config/pass/pass\";\n            var loadedCallback = function(err,res){\n                if(err){\n                    cc.log(\"load all pass finished config list len\",idx);\n                    this.savePassAuto();\n                    this.savePassAll();\n                    onFinished();\n                    return;\n                }\n\n                //兼容旧配置\n                res.mapInfo.scale = res.mapInfo.scale || 1.0;\n\n                this.configList[idx]=res;\n                idx++;\n                cc.resMgr.loadEditorRes(path+idx,loadedCallback);\n            }.bind(this);\n            cc.resMgr.loadEditorRes(path+idx,loadedCallback);\n        }else{\n            var loadedCallback = function(err,res){\n                if(err){\n                    cc.error(\"load all pass failed\");\n                    return;\n                }\n\n                //兼容旧配置\n                for(var key in res){\n                    var aRes = res[key];\n                    if(aRes){\n                        aRes.mapInfo.scale = aRes.mapInfo.scale || 1.0;\n                    }\n                }\n\n                this.configList = res;\n                cc.log(\"load all pass finished config list len\",this.configList.length);\n                onFinished();\n            }.bind(this);\n            cc.resMgr.loadEditorRes(\"/config/pass/passAll\",loadedCallback);\n        }\n    },\n    loadPass(passIdx,callback){\n        cc.log(\"PassMgr:loadPass\",passIdx);\n        if(this.configList[passIdx]){\n            cc.log(\"PassMgr:loadPass from cache\",\n                JSON.stringify(this.configList[passIdx]));\n            this.initCurPassData(passIdx);\n            callback(true);\n            return;\n        }\n        var url = \"/config/pass/pass\"+passIdx;\n        cc.resMgr.loadRes(url,function(err,res){\n            if(err){\n                if(cc.gameConfig.isEditorMode){\n                    cc.log(\"PassData:loadPass\",url,\"failure will init by template\");\n                    this.configList[passIdx]=cc.utils.clone(this.template);\n                    this.initCurPassData(passIdx);\n                    callback(true);\n                }else{\n                    cc.log(\"PassData:loadPass\",url,\"failure\");\n                    callback(false);\n                }\n                return;\n            }\n            cc.log(\"PassData:loadPass\",url,\" success\");\n\n            //兼容旧配置\n            res.mapInfo.scale = res.mapInfo.scale || 1.0;\n\n            this.configList[passIdx]=res;\n            this.initCurPassData(passIdx);\n            callback(true);\n        }.bind(this));\n    },\n    savePassAuto(){\n        this.passAuto.passCount = this.configList.length;\n        cc.resMgr.writeEditorRes(\"/config/pass/passAuto.json\",JSON.stringify(this.passAuto));\n    },\n    savePassAll(){\n        cc.resMgr.writeEditorRes(\"/config/pass/passAll.json\",JSON.stringify(this.configList));\n    },\n    savePass(passIdx){\n        cc.resMgr.writeEditorRes(\"/config/pass/pass\"+passIdx+\".json\",JSON.stringify(this.configList[passIdx]));\n        this.savePassAuto();\n    },\n    initCurPassData(passIdx){\n        this.curPassData.initConfigData(passIdx);\n        this.curEditorData = {curMatierl:0};\n        cc.userData.savePass(passIdx);\n    },\n    getPassCount(){\n        return this.passAuto.passCount;\n    },\n    getConfigData(passIdx){\n        return this.configList[passIdx];\n    },\n    getConfigList(){\n        return this.configList;\n    },\n    getCurPassData(){\n        return this.curPassData;\n    },\n    getCurPassIdx(){\n        return this.curPassData.passIdx;\n    },\n    getCurEditorData(){\n        return this.curEditorData;\n    },\n    getCommonConfig(){\n        return this.commonConfig;\n    },\n});"]}