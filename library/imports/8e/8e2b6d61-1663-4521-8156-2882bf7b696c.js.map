{"version":3,"sources":["../../../../../assets/scripts/component/assets/scripts/component/ResultWnd.js"],"names":["cc","Class","extends","Component","properties","lostWnd","default","undefined","type","Node","winWnd","lastWnd","recommendWnd","tpl","content","ctor","CC_EDITOR","globalEvent","on","updateResult","onLoad","active","gameCtrl","needShowRecommend","atlas","resMgr","getRes","resName","commonui","list","gameConfig","recommendGame_FB","i","length","newItem","instantiate","parent","itemIdx","frame","getSpriteFrame","icon","sp","getComponent","Sprite","spriteFrame","layout","Layout","contentW","paddingLeft","spacingX","paddingRight","width","onDestroy","off","curPassData","passData","getCurPassData","curPassIdx","getCurPassIdx","passCount","getPassCount","node","gameResult","_isOnLoadCalled","share","invite","replay","initGameData","next","playPassAD","loadPass","success","error","bind","main","utils","loadScene","clickRecommend","event","target","currentTarget","requestRecommend"],"mappings":"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","file":"ResultWnd.js","sourceRoot":"../../../../../assets/scripts/component","sourcesContent":["cc.Class({\n    extends:cc.Component,\n    properties:{\n        lostWnd:{\n            default:undefined,\n            type:cc.Node,\n        },\n        winWnd:{\n            default:undefined,\n            type:cc.Node,\n        },\n        lastWnd:{\n            default:undefined,\n            type:cc.Node,\n        },\n        recommendWnd:{\n            default:undefined,\n            type:cc.Node,\n        },\n        tpl:{\n            default:undefined,\n            type:cc.Node,\n        },\n        content:{\n            default:undefined,\n            type:cc.Node,\n        }\n    },\n    ctor(){\n        if(!CC_EDITOR){\n            cc.globalEvent.on(\"CurData:UpdateResult\",this.updateResult,this);\n        }\n    },\n    onLoad(){\n        this.recommendWnd.active = cc.gameCtrl.needShowRecommend();\n        this.atlas = cc.resMgr.getRes(cc.resName.commonui);\n        if(this.recommendWnd.active){\n            var list = cc.gameConfig.recommendGame_FB;\n            for(var i=0;i<list.length;i++){\n                var newItem = this.tpl;\n                if(i>0){\n                    newItem = cc.instantiate(this.tpl);\n                    newItem.parent = this.tpl.parent;\n                }\n                newItem.itemIdx = i;\n                var frame = this.atlas.getSpriteFrame(list[i].icon);\n                var sp = newItem.getComponent(cc.Sprite);\n                sp.spriteFrame = frame;\n            }\n\n            var layout = this.content.getComponent(cc.Layout);\n            var contentW = layout.paddingLeft + list.length*layout.spacingX + layout.paddingRight+list.length*this.tpl.width;\n            if(this.content.width<contentW){\n                this.content.width = contentW;\n            }\n        }\n        cc.globalEvent.on(\"CurData:UpdateResult\",this.updateResult,this);\n        this.updateResult();\n    },\n    onDestroy(){\n        cc.globalEvent.off(\"CurData:UpdateResult\",this.updateResult,this);\n    },\n    updateResult(){\n        var curPassData = cc.passData.getCurPassData();\n        var curPassIdx = cc.passData.getCurPassIdx();\n        var passCount = cc.passData.getPassCount();\n        this.node.active = (curPassData.gameResult!=undefined);\n        if(!this._isOnLoadCalled)return;\n        if(curPassIdx<passCount-1){\n            if(curPassData.gameResult==\"win\"){\n                this.winWnd.active = true;\n                this.lostWnd.active = false;\n            }else{\n                this.winWnd.active = false;\n                this.lostWnd.active = true;\n            }\n            this.lastWnd.active = false;\n        }else{\n            this.lostWnd.active = false;\n            this.winWnd.active = false;\n            this.lastWnd.active = true;\n        }\n    },\n    share(){\n        cc.gameCtrl.invite();\n    },\n    replay(){\n        var curPassData = cc.passData.getCurPassData();\n        curPassData.initGameData();    \n    },\n    next(){\n        cc.gameCtrl.playPassAD(function(){\n            var curPassIdx = cc.passData.getCurPassIdx();\n            curPassIdx++;\n            cc.passData.loadPass(curPassIdx,function(success){\n                if(!success){\n                    cc.error(\"load pass config failure\",curPassIdx);\n                    return;\n                }\n            }.bind(this));\n        }.bind(this));\n    },\n    main(){\n        cc.utils.loadScene(\"select\");\n    },\n    clickRecommend(event){\n        var target = event.currentTarget;\n        var itemIdx = target.itemIdx;\n        cc.gameCtrl.requestRecommend(itemIdx);\n    }\n})"]}