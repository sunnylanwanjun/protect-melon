{"version":3,"sources":["../../../../../assets/scripts/component/assets/scripts/component/EditorMapBg.js"],"names":["cc","Class","extends","Component","properties","rowCol","default","undefined","type","Label","onLoad","Pool","require","gridPool","setBuildFunc","gridNode","Node","sp","addComponent","Sprite","spriteFrame","atlas","getSpriteFrame","parent","node","bind","setResetFunc","x","y","gridHelp","resMgr","getRes","resName","commonui","active","curPassData","passData","getCurPassData","globalEvent","on","updateGridHelp","updateMapBgSize","updateMapBgPos","onDestroy","off","event","gridInfo","detail","isMouseDown","string","zIndex","row","col","mapSize","setContentSize","w","h","scale","begPos","convertToNodeSpace","v2","endPos","winSize","width","height","reset","maxInfo","configData","mapInfo","begInfo","getGridInfoByMousePos","endInfo","get","pos","getGridPosByRowCol"],"mappings":";;;;;;AAAAA,GAAGC,KAAH,CAAS;AACLC,aAAQF,GAAGG,SADN;AAELC,gBAAW;AACPC,gBAAO;AACHC,qBAAQC,SADL;AAEHC,kBAAKR,GAAGS;AAFL;AADA,KAFN;AAQLC,UARK,oBAQG;AACJ,YAAIC,OAAOC,QAAQ,MAAR,CAAX;AACA,aAAKC,QAAL,GAAgB,IAAIF,IAAJ,EAAhB;AACA,aAAKE,QAAL,CAAcC,YAAd,CAA2B,YAAU;AACjC,gBAAIC,WAAW,IAAIf,GAAGgB,IAAP,EAAf;AACA,gBAAIC,KAAKF,SAASG,YAAT,CAAsBlB,GAAGmB,MAAzB,CAAT;AACAF,eAAGG,WAAH,GAAiB,KAAKC,KAAL,CAAWC,cAAX,CAA0B,aAA1B,CAAjB;AACAP,qBAASQ,MAAT,GAAkB,KAAKC,IAAvB;;AAEA,mBAAOT,QAAP;AACH,SAP0B,CAOzBU,IAPyB,CAOpB,IAPoB,CAA3B;AAQA,aAAKZ,QAAL,CAAca,YAAd,CAA2B,UAASX,QAAT,EAAkB;AACzCA,qBAASY,CAAT,GAAa,CAAC,MAAd;AACAZ,qBAASa,CAAT,GAAa,CAAC,MAAd;AACH,SAH0B,CAGzBH,IAHyB,CAGpB,IAHoB,CAA3B;;AAKA,aAAKI,QAAL,GAAgB,IAAI7B,GAAGgB,IAAP,EAAhB;AACA,aAAKK,KAAL,GAAarB,GAAG8B,MAAH,CAAUC,MAAV,CAAiB/B,GAAGgC,OAAH,CAAWC,QAA5B,CAAb;AACA,YAAIhB,KAAK,KAAKY,QAAL,CAAcX,YAAd,CAA2BlB,GAAGmB,MAA9B,CAAT;AACAF,WAAGG,WAAH,GAAiB,KAAKC,KAAL,CAAWC,cAAX,CAA0B,iBAA1B,CAAjB;AACA,aAAKO,QAAL,CAAcN,MAAd,GAAuB,KAAKC,IAA5B;AACA,aAAKK,QAAL,CAAcK,MAAd,GAAuB,KAAvB;;AAEA,aAAKC,WAAL,GAAmBnC,GAAGoC,QAAH,CAAYC,cAAZ,EAAnB;;AAEArC,WAAGsC,WAAH,CAAeC,EAAf,CAAkB,uBAAlB,EAA0C,KAAKC,cAA/C,EAA8D,IAA9D;AACAxC,WAAGsC,WAAH,CAAeC,EAAf,CAAkB,wBAAlB,EAA2C,KAAKE,eAAhD,EAAgE,IAAhE;AACAzC,WAAGsC,WAAH,CAAeC,EAAf,CAAkB,uBAAlB,EAA0C,KAAKG,cAA/C,EAA8D,IAA9D;;AAEA,aAAKD,eAAL;AACH,KAtCI;AAuCLE,aAvCK,uBAuCM;AACP3C,WAAGsC,WAAH,CAAeM,GAAf,CAAmB,uBAAnB,EAA2C,KAAKJ,cAAhD,EAA+D,IAA/D;AACAxC,WAAGsC,WAAH,CAAeM,GAAf,CAAmB,wBAAnB,EAA4C,KAAKH,eAAjD,EAAiE,IAAjE;AACAzC,WAAGsC,WAAH,CAAeM,GAAf,CAAmB,uBAAnB,EAA2C,KAAKF,cAAhD,EAA+D,IAA/D;AACH,KA3CI;AA4CLF,kBA5CK,0BA4CUK,KA5CV,EA4CgB;AACjB,YAAIC,WAAWD,MAAME,MAAN,CAAaD,QAA5B;AACA,YAAIE,cAAcH,MAAME,MAAN,CAAaC,WAA/B;AACA,YAAG,CAACF,QAAD,IAAWE,WAAd,EAA0B;AACtB,iBAAK3C,MAAL,CAAY4C,MAAZ,GAAqB,EAArB;AACA,iBAAKpB,QAAL,CAAcK,MAAd,GAAuB,KAAvB;AACA;AACH;;AAED,aAAKL,QAAL,CAAcF,CAAd,GAAkBmB,SAASnB,CAA3B;AACA,aAAKE,QAAL,CAAcD,CAAd,GAAkBkB,SAASlB,CAA3B;AACA,aAAKC,QAAL,CAAcK,MAAd,GAAuB,IAAvB;AACA,aAAKL,QAAL,CAAcqB,MAAd,GAAuB,KAAvB;AACA,aAAK7C,MAAL,CAAY4C,MAAZ,GAAqB,OAAKH,SAASK,GAAd,GAAkB,KAAlB,GAAwBL,SAASM,GAAtD;AACH,KA1DI;AA2DLX,mBA3DK,6BA2DY;AACb,YAAIY,UAAU,KAAKlB,WAAL,CAAiBkB,OAA/B;AACA,aAAK7B,IAAL,CAAU8B,cAAV,CAAyBD,QAAQE,CAAjC,EAAmCF,QAAQG,CAA3C;AACH,KA9DI;AA+DLd,kBA/DK,0BA+DUG,KA/DV,EA+DgB;AACjB,YAAIlB,IAAIkB,MAAME,MAAN,CAAapB,CAArB;AACA,YAAIC,IAAIiB,MAAME,MAAN,CAAanB,CAArB;AACA,YAAI6B,QAAQZ,MAAME,MAAN,CAAaU,KAAzB;AACA,aAAKjC,IAAL,CAAUG,CAAV,GAAcA,CAAd;AACA,aAAKH,IAAL,CAAUI,CAAV,GAAcA,CAAd;AACA,aAAKJ,IAAL,CAAUiC,KAAV,GAAkBA,KAAlB;;AAEA,YAAIC,SAAS,KAAKlC,IAAL,CAAUmC,kBAAV,CAA6B3D,GAAG4D,EAAH,CAAM,CAAN,EAAS,CAAT,CAA7B,CAAb;AACA,YAAIC,SAAS,KAAKrC,IAAL,CAAUmC,kBAAV,CAA6B3D,GAAG4D,EAAH,CAAM5D,GAAG8D,OAAH,CAAWC,KAAjB,EAAwB/D,GAAG8D,OAAH,CAAWE,MAAnC,CAA7B,CAAb;;AAEA,aAAKnD,QAAL,CAAcoD,KAAd;AACA,YAAIC,UAAU,KAAK/B,WAAL,CAAiBgC,UAAjB,CAA4BC,OAA1C;AACA,YAAIC,UAAU,KAAKlC,WAAL,CAAiBmC,qBAAjB,CAAuCZ,OAAO/B,CAA9C,EAAgD+B,OAAO9B,CAAvD,CAAd;AACA,YAAG,CAACyC,OAAJ,EAAY;AACRA,sBAAU,EAAClB,KAAI,CAAL,EAAOC,KAAI,CAAX,EAAV;AACH;AACD,YAAImB,UAAU,KAAKpC,WAAL,CAAiBmC,qBAAjB,CAAuCT,OAAOlC,CAA9C,EAAgDkC,OAAOjC,CAAvD,CAAd;AACA,YAAG,CAAC2C,OAAJ,EAAY;AACRA,sBAAU,EAACpB,KAAI,CAAL,EAAOC,KAAI,CAAX,EAAV;AACH;;AAED,YAAGiB,QAAQlB,GAAR,GAAYe,QAAQf,GAAvB,EAA2BkB,QAAQlB,GAAR,GAAYe,QAAQf,GAApB;AAC3B,YAAGkB,QAAQjB,GAAR,GAAYc,QAAQd,GAAvB,EAA2BiB,QAAQjB,GAAR,GAAYc,QAAQd,GAApB;AAC3B,YAAGmB,QAAQpB,GAAR,GAAYe,QAAQf,GAAvB,EAA2BoB,QAAQpB,GAAR,GAAYe,QAAQf,GAApB;AAC3B,YAAGoB,QAAQnB,GAAR,GAAYc,QAAQd,GAAvB,EAA2BmB,QAAQnB,GAAR,GAAYc,QAAQd,GAApB;;AAE3B,aAAI,IAAID,MAAIkB,QAAQlB,GAApB,EAAwBA,OAAKoB,QAAQpB,GAArC,EAAyCA,KAAzC,EAA+C;AAC3C,iBAAI,IAAIC,MAAIiB,QAAQjB,GAApB,EAAwBA,OAAKmB,QAAQnB,GAArC,EAAyCA,KAAzC,EAA+C;AAC3C,oBAAIrC,WAAW,KAAKF,QAAL,CAAc2D,GAAd,EAAf;AACA,oBAAIC,MAAM,KAAKtC,WAAL,CAAiBuC,kBAAjB,CAAoCvB,GAApC,EAAwCC,GAAxC,CAAV;AACArC,yBAASY,CAAT,GAAa8C,IAAI9C,CAAjB;AACAZ,yBAASa,CAAT,GAAa6C,IAAI7C,CAAjB;AACH;AACJ;AACJ;AAlGI,CAAT","file":"EditorMapBg.js","sourceRoot":"../../../../../assets/scripts/component","sourcesContent":["cc.Class({\n    extends:cc.Component,\n    properties:{\n        rowCol:{\n            default:undefined,\n            type:cc.Label,\n        }\n    },\n    onLoad(){\n        var Pool = require(\"Pool\");\n        this.gridPool = new Pool();\n        this.gridPool.setBuildFunc(function(){\n            var gridNode = new cc.Node();\n            var sp = gridNode.addComponent(cc.Sprite);\n            sp.spriteFrame = this.atlas.getSpriteFrame(\"ui-frame-bg\");\n            gridNode.parent = this.node;\n\n            return gridNode;\n        }.bind(this));\n        this.gridPool.setResetFunc(function(gridNode){\n            gridNode.x = -100000;\n            gridNode.y = -100000;\n        }.bind(this));\n\n        this.gridHelp = new cc.Node();\n        this.atlas = cc.resMgr.getRes(cc.resName.commonui);\n        var sp = this.gridHelp.addComponent(cc.Sprite);\n        sp.spriteFrame = this.atlas.getSpriteFrame(\"ui-select-frame\");\n        this.gridHelp.parent = this.node;\n        this.gridHelp.active = false;\n\n        this.curPassData = cc.passData.getCurPassData();\n\n        cc.globalEvent.on(\"Editor:UpdateGridHelp\",this.updateGridHelp,this);\n        cc.globalEvent.on(\"Editor:UpdateMapBgSize\",this.updateMapBgSize,this);\n        cc.globalEvent.on(\"Editor:UpdateMapBgPos\",this.updateMapBgPos,this);\n\n        this.updateMapBgSize();\n    },\n    onDestroy(){\n        cc.globalEvent.off(\"Editor:UpdateGridHelp\",this.updateGridHelp,this);\n        cc.globalEvent.off(\"Editor:UpdateMapBgSize\",this.updateMapBgSize,this);\n        cc.globalEvent.off(\"Editor:UpdateMapBgPos\",this.updateMapBgPos,this);\n    },\n    updateGridHelp(event){\n        var gridInfo = event.detail.gridInfo;\n        var isMouseDown = event.detail.isMouseDown;\n        if(!gridInfo||isMouseDown){\n            this.rowCol.string = \"\";\n            this.gridHelp.active = false;\n            return;\n        }\n\n        this.gridHelp.x = gridInfo.x;\n        this.gridHelp.y = gridInfo.y;\n        this.gridHelp.active = true;\n        this.gridHelp.zIndex = 10000;\n        this.rowCol.string = \"r:\"+gridInfo.row+\" c:\"+gridInfo.col;\n    },\n    updateMapBgSize(){\n        var mapSize = this.curPassData.mapSize;\n        this.node.setContentSize(mapSize.w,mapSize.h); \n    },\n    updateMapBgPos(event){\n        var x = event.detail.x;\n        var y = event.detail.y;\n        var scale = event.detail.scale;\n        this.node.x = x;\n        this.node.y = y;\n        this.node.scale = scale;\n\n        var begPos = this.node.convertToNodeSpace(cc.v2(0, 0));\n        var endPos = this.node.convertToNodeSpace(cc.v2(cc.winSize.width, cc.winSize.height));\n\n        this.gridPool.reset();\n        var maxInfo = this.curPassData.configData.mapInfo;\n        var begInfo = this.curPassData.getGridInfoByMousePos(begPos.x,begPos.y);\n        if(!begInfo){\n            begInfo = {row:0,col:0};\n        }\n        var endInfo = this.curPassData.getGridInfoByMousePos(endPos.x,endPos.y);\n        if(!endInfo){\n            endInfo = {row:0,col:0};\n        }\n\n        if(begInfo.row>maxInfo.row)begInfo.row=maxInfo.row;\n        if(begInfo.col>maxInfo.col)begInfo.col=maxInfo.col;\n        if(endInfo.row>maxInfo.row)endInfo.row=maxInfo.row;\n        if(endInfo.col>maxInfo.col)endInfo.col=maxInfo.col;\n        \n        for(var row=begInfo.row;row<=endInfo.row;row++){\n            for(var col=begInfo.col;col<=endInfo.col;col++){\n                var gridNode = this.gridPool.get();\n                var pos = this.curPassData.getGridPosByRowCol(row,col);\n                gridNode.x = pos.x;\n                gridNode.y = pos.y;\n            }\n        }\n    }\n});"]}