{"version":3,"sources":["../../../../../assets/scripts/component/assets/scripts/component/Game.js"],"names":["cc","Class","extends","Component","properties","btnEditor","default","undefined","type","Node","passLabel","Label","itemTpl","showGridBtn","nextRoadBtn","onLoad","Pool","require","gridPool","itemParent","parent","setResetFunc","gridNode","removeChild","bind","itemOrder","constVal","ItemOrder","i","length","newItem","instantiate","push","active","gameConfig","isEditorMode","globalEvent","on","initGameData","updateItemList","curPassData","passData","getCurPassData","string","passIdx","onDestroy","off","start","reset","selectItemType","getSelectItemType","itemData","curTurnData","itemArr","itemType","item","itemNum","get","scaleX","scaleY","color","Color","label","getChildByName","getComponent","toEditor","utils","loadScene","toSelect","addItem","event","gameCtrl","playItemAD","selectItem","target","currentTarget","unSelectItem"],"mappings":"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","file":"Game.js","sourceRoot":"../../../../../assets/scripts/component","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        btnEditor:{\n            default:undefined,\n            type:cc.Node,\n        },\n        passLabel:{\n            default:undefined,\n            type:cc.Label,\n        },\n        itemTpl:{\n            default:undefined,\n            type:cc.Node,\n        },\n        showGridBtn:{\n            default:undefined,\n            type:cc.Node,\n        },\n        nextRoadBtn:{\n            default:undefined,\n            type:cc.Node,\n        },\n    },\n\n    onLoad () {\n        var Pool = require(\"Pool\");\n        this.gridPool = new Pool();\n        this.itemParent = this.itemTpl.parent;\n        this.gridPool.setResetFunc(function(gridNode){\n            this.itemParent.removeChild(gridNode);\n        }.bind(this));\n\n        var itemOrder = cc.constVal.ItemOrder;\n        for(var i=0;i<itemOrder.length;i++){\n            var newItem = this.itemTpl;\n            if(i>0){\n                newItem = cc.instantiate(this.itemTpl);\n                newItem.parent = this.itemParent;\n            }\n            this.gridPool.push(newItem);\n        }\n\n        this.nextRoadBtn.active = cc.gameConfig.isEditorMode;\n        this.showGridBtn.active = cc.gameConfig.isEditorMode;\n        this.btnEditor.active = cc.gameConfig.isEditorMode;\n\n        cc.globalEvent.on(\"CurData:InitGameData\",this.initGameData,this);\n        this.initGameData();\n\n        cc.globalEvent.on(\"CurData:UpdateItemlist\",this.updateItemList,this);\n        this.updateItemList();\n    },\n\n    initGameData(){\n        this.curPassData = cc.passData.getCurPassData();\n        this.passLabel.string = \"pass:\"+this.curPassData.passIdx;\n    },\n\n    onDestroy(){\n        cc.globalEvent.off(\"CurData:UpdateItemlist\",this.updateItemList,this);\n\t    cc.globalEvent.off(\"CurData:InitGameData\",this.initGameData,this);\n    },\n\n    start () {\n\n    },\n\n    // update (dt) {},\n\n    updateItemList(){\n        this.gridPool.reset();\n\n        var selectItemType = this.curPassData.getSelectItemType();\n        var itemData = this.curPassData.curTurnData.itemData;\n        var itemOrder = cc.constVal.ItemOrder;\n        this.itemArr = {};\n        for(var i=0;i<itemOrder.length;i++){\n            var itemType = itemOrder[i];\n            var item = itemData[itemType];\n            if(!item){\n                continue;\n            }\n            var itemNum = item.length;\n            if(itemNum<=0){\n                continue;\n            }\n            var newItem = this.gridPool.get();\n            newItem.itemType = itemOrder[i];\n            newItem.parent = this.itemParent;\n            newItem.scaleX = 1.0;\n            newItem.scaleY = 1.0;\n\n            if(itemType == selectItemType){\n                newItem.color = new cc.Color(0, 100, 0);\n            }else{\n                newItem.color = new cc.Color(255, 255, 255);\n            }\n            this.itemArr[itemType] = newItem;\n            var label = newItem.getChildByName(\"Label\").getComponent(cc.Label);\n            label.string = itemOrder[i]+\"(\"+itemNum+\")\";\n        }\n    },\n\n    toEditor(){\n        cc.utils.loadScene(\"editor\");\n    },\n\n    toSelect(){\n        cc.utils.loadScene(\"select\");\n    },\n\n    addItem(event){\n        cc.gameCtrl.playItemAD();\n    },\n\n    selectItem(event){\n        var target = event.currentTarget;\n        var itemType = target.itemType;\n\n        var selectItemType = this.curPassData.getSelectItemType();\n        if(selectItemType==itemType){\n            this.curPassData.unSelectItem();\n            return;\n        }\n\n        this.curPassData.selectItem(itemType);\n        var selectItemType = this.curPassData.getSelectItemType();\n        if(selectItemType){\n            var item = this.itemArr[selectItemType];\n            item.color = new cc.Color(0, 100, 0);\n        }\n    },\n});\n"]}